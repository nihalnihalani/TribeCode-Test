{% extends "base.html" %}

{% block content %}
<div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 2rem;">
    <h1 class="page-title">Dashboard Overview</h1>
    <a href="/scout" class="btn btn-primary">
        <img src="https://img.icons8.com/?id=WwWusvLMTFd7&format=png&size=20" style="filter: invert(1);">
        New Scout Mission
    </a>
</div>

<!-- Key Metrics -->
<div class="stats-grid">
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <span class="stat-label">Total Interacted</span>
                <span class="stat-value">{{ stats.total }}</span>
            </div>
            <div style="padding: 8px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                <img src="https://img.icons8.com/?id=123464&format=png&size=24" style="filter: invert(1);">
            </div>
        </div>
    </div>
    
    <div class="stat-card">
        <div style="display: flex; justify-content: space-between; align-items: start;">
            <div>
                <span class="stat-label">X (Twitter)</span>
                <span class="stat-value">{{ stats.twitter }}</span>
            </div>
            <div style="padding: 8px; background: rgba(56, 189, 248, 0.2); border-radius: 8px;">
                <img src="https://img.icons8.com/?id=ClbD5JTFM7FA&format=png&size=24" style="filter: invert(1);">
            </div>
        </div>
    </div>
</div>

<div style="display: grid; grid-template-columns: 2fr 1fr; gap: 2rem;">
    <!-- Recent Activity Feed -->
    <div class="card">
        <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 1.5rem;">
            <h3 style="margin:0; font-size: 1.2rem; font-weight: 600;">Recent Pulse</h3>
            <a href="/interactions" style="color: var(--primary-color); text-decoration: none; font-weight: 600; font-size: 0.9rem; display: flex; align-items: center; gap: 6px; transition: opacity 0.2s;">
                View All <img src="https://img.icons8.com/?id=86525&format=png&size=16" style="width: 12px; filter: brightness(0) invert(1) opacity(0.7);">
            </a>
        </div>
        
        <div class="feed-preview">
            {% for interaction in interactions %}
            <div style="padding: 1.25rem 0; border-bottom: 1px solid var(--border-color); display: flex; align-items: start; gap: 1rem;">
                <div style="width: 42px; height: 42px; border-radius: 10px; background: rgba(56, 189, 248, 0.15); display: flex; align-items: center; justify-content: center; flex-shrink: 0; border: 1px solid rgba(56, 189, 248, 0.2);">
                    <img src="https://img.icons8.com/?id=ClbD5JTFM7FA&format=png&size=24" style="filter: invert(1);">
                </div>
                <div style="flex-grow: 1;">
                    <div style="font-weight: 500; font-size: 1rem; margin-bottom: 0.35rem; line-height: 1.5; color: var(--text-main);">
                        {{ interaction.post_content[:90] }}...
                    </div>
                    <div style="font-size: 0.8rem; color: var(--text-muted);">
                        {{ interaction.created_at.strftime('%b %d, %H:%M') }} â€¢ <span style="color: var(--text-light);">{{ interaction.platform }}</span>
                    </div>
                </div>
                {% if interaction.status == 'POSTED' %}
                <span style="background: rgba(16, 185, 129, 0.15); color: var(--success-color); font-size: 0.7rem; padding: 4px 8px; border-radius: 4px; font-weight: 600; letter-spacing: 0.05em; border: 1px solid rgba(16, 185, 129, 0.2);">REPLIED</span>
                {% endif %}
            </div>
            {% else %}
            <div style="text-align: center; padding: 4rem 1rem;">
                <div style="width: 72px; height: 72px; background: rgba(255,255,255,0.05); border-radius: 50%; display: flex; align-items: center; justify-content: center; margin: 0 auto 1.5rem; border: 1px solid var(--border-color);">
                    <img src="https://img.icons8.com/?id=10601&format=png&size=36" style="opacity: 0.5; filter: invert(1);">
                </div>
                <p style="color: var(--text-muted); margin-bottom: 1.5rem; font-size: 1.1rem;">No signal detected yet.</p>
                <a href="/scout" class="btn btn-sm btn-primary">Start Scanning</a>
            </div>
            {% endfor %}
        </div>
    </div>

    <!-- Chart -->
    <div class="card">
        <h3 style="margin:0 0 1.5rem 0; font-size: 1.2rem;">Source Distribution</h3>
        <div style="position: relative; height: 250px; display: flex; align-items: center; justify-content: center;">
            <canvas id="platformChart"></canvas>
        </div>
    </div>
</div>

<script>
    // Set Chart default color for dark theme
    Chart.defaults.color = '#a1a1aa';
    Chart.defaults.borderColor = 'rgba(255,255,255,0.05)';
    Chart.defaults.font.family = 'Inter';
    
    const ctx = document.getElementById('platformChart').getContext('2d');
    new Chart(ctx, {
        type: 'doughnut',
        data: {
            labels: ['Twitter/X'],
            datasets: [{
                data: [{{ stats.twitter }}],
                backgroundColor: ['#0ea5e9'],
                borderWidth: 0,
                hoverOffset: 10
            }]
        },
        options: {
            responsive: true,
            maintainAspectRatio: false,
            plugins: {
                legend: { 
                    position: 'bottom',
                    labels: {
                        padding: 25,
                        usePointStyle: true,
                        pointStyle: 'circle',
                        font: { family: 'Inter', size: 12, weight: 500 }
                    }
                },
                tooltip: {
                    backgroundColor: 'rgba(0,0,0,0.8)',
                    padding: 12,
                    cornerRadius: 8,
                    titleFont: { family: 'Inter', size: 13 },
                    bodyFont: { family: 'Inter', size: 13 }
                }
            },
            cutout: '80%'
        }
    });
</script>
{% endblock %}
